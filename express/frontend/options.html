<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width-device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <link rel="stylesheet" href="HTElements/css/custom.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js"
        integrity="sha384-7VPbUDkoPSGFnVtYi0QogXtr74QeVeeIs99Qfg5YCF+TidwNdjvaKZX19NZ/e6oz"
        crossorigin="anonymous"></script>
    <title>Tela Inicial</title>
    <link rel="stylesheet" href="options.css">
</head>

<body style="height:100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;" ,
    onload="LoadAlert(), checkAcess()">
    <div style="position: absolute; top: 20px; left: 20px;">
        <button type="button" class="btn btn-danger" onclick="window.location.href='login.html'">
            <img src="HTElements/icons/x-mark-3-32.png"> &nbsp; Sair
        </button>
        <p id="mensagem" class="mensagem fixed-welcome"></p>
        <div>
            <div class="container">
                <a id="lista-anchor" class="btn btn-warning fixed-button">
                    <img src="HTElements/icons/warning-5-32.png" alt="">
                    <span id="numNotif" class="notification-bubble">3</span>
                </a>
            </div>
            <div id="lista-popup">
                <button id="fechar-popup">&times;</button>
                <ul id="alert-ul">
                </ul>
            </div>
            <div class="backdrop"></div>
        </div>
    </div>
    <h2 style=" position: fixed; top: 20px; left: 50%; transform: translateX(-50%); margin: 0; padding: 10px;">
        Gerenciador de Estoque</h2>
    <div class="container text-center">
        <div class="container container-45">
            <div class="row" id="testXd">
                <div class="col-md-4">
                    <button class="btn btn-danger mb-3" onclick="window.location.href='./Supplier/listSupplier.html'">
                        <img src="HTElements/icons/truck-128.png">
                        <p>FORNECEDORES</p>
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-primary mb-3" onclick="window.location.href='listUsers.html'">
                        <img src="HTElements/icons/user-128.png">
                        <p>USUÁRIOS</p>
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-success mb-3" onclick="window.location.href='./Products/listProduct.html'">
                        <img src="HTElements/icons/cheese-128.png">
                        <p>PRODUTOS</p>
                    </button><br>
                </div>
            </div>
        </div>
        <div class="container container-45">
            <div class="row">
                <div class="col-md-4" id="acessDenied">
                    <button class="btn btn-warning mb-3" 
                        onclick="window.location.href='./Order/ListOrder.html'">
                        <img src="HTElements/icons/list-2-128.png">
                        <p style="color:white">PEDIDOS</p>
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-info mb-3" onclick="window.location.href='./Stock/ListStock.html'">
                        <img src="HTElements/icons/product-128.png" alt="">
                        <p style="color:white">ESTOQUE</p>
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-secondary mb-3" onclick="window.location.href='./relatorio/index.html'">
                        <img src="HTElements/icons/report-3-128.png">
                        <p>RELATÓRIOS</p>
                    </button>
                </div>
            </div>
        </div>
    </div>


    <br>

    </div>
</body>

<script>

    const listaAnchor = document.getElementById('lista-anchor');
    const listaPopup = document.getElementById('lista-popup');

    listaAnchor.addEventListener('click', function () {
        listaPopup.style.display = 'block';
    });

    document.addEventListener('click', function (event) {
        if (event.target !== listaAnchor && event.target !== listaPopup) {
            listaPopup.style.display = 'none';
        }
    });

    let userName = localStorage.getItem("userNameLogged");
    let outroElemento = document.getElementById("mensagem");

    outroElemento.textContent = `Olá, ${userName}, seja bem-vindo!`;

</script>
<script>
    const popup = document.querySelector('#lista-popup');
    const fecharPopup = document.querySelector('#fechar-popup');
    const backdrop = document.querySelector('.backdrop');
    const abrirLista = document.querySelector('#lista-anchor');
    const imgBotao = document.querySelector('#lista-anchor img');
    const spanBotao = document.querySelector('#lista-anchor span');

    fecharPopup.addEventListener('click', () => {
        popup.classList.remove('active'); // Remove a classe 'active' da lista
        popup.style.display = 'none';
        backdrop.classList.remove('active'); // Remove a classe 'active' do fundo
    });

    abrirLista.addEventListener('click', () => {
        popup.classList.add('active');
        backdrop.classList.add('active');
    });
    imgBotao.addEventListener('click', (event) => {
        event.stopPropagation();
        abrirLista.click();
    });
    spanBotao.addEventListener('click', (event) => {
        event.stopPropagation();
        abrirLista.click();
    });

    listaPopup.addEventListener('click', (event) => {
        event.stopPropagation();
    });

    backdrop.addEventListener('click', () => {
        fecharPopup.click()
    });

    function LoadAlert() {

        var listAlert = document.getElementById("alert-ul");

        axios.get(`http://localhost:8080/stock/alert`)
            .then(function (response) {
                var alertList = response.data;

                alertList.forEach(element => {

                    const novoLiElement = document.createElement('li');
                    novoLiElement.textContent = element.response;


                    listAlert.appendChild(novoLiElement);
                });


            })
            .catch(function (error) {
                console.log(error);
            });
    }

    function checkAcess() {

        const
            userType = localStorage.getItem("userType"),
            botao = document.getElementById("testXd"),
            order = document.getElementById("acessDenied");

        if (userType === "gerente") {
            order.style.display = "block"
            botao.style.display = "flex"
        } else {
            order.style.display = "none";
            botao.style.display = "none";
        }
    }

</script>

</html>